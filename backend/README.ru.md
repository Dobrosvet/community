# Бекенд Open Longevity Community

❗ НЕ ЗАБЫТЬ спроектировать всё так что бы это всё работало на AWS но и можно было легко развернуть всё на локальном компьютере и со своими аккаунтами, то есть возможность тестового полигона

## Конфигурация

Конфигурация приложения это файл `.env`. Его механика такова что он хранит переменные окружения которые считываются приложением и недоступны извне, что бы не было утечки API ключей, учётных данных и другой информации. Так например случайная запись в репозиторий или тем более публикация этого файла в репозитории GitHub заблокирована.

Файл `.env`:

```
# Dropbox
STORAGE_URL = '...'
DROPBOX_ACCESS_TOKEN = '...'
DROPBOX_APP_SECRET = '...'
DROPBOX_APP_KEY = '...'

# Airtable
AIRTABLE_API_KEY = '...'
AIRTABLE_BASE_ID = '...'
AIRTABLE_USER_TABLE_NAME = '...'
AIRTABLE_CARD_TABLE_NAME = '...'
```

Соответственно нужно получить API ключи и остальные данные для учётных записей Airtable и Dropbox которые будут использоваться для работы сервиса генерации карточек и других.

## Работа с AWS Lambda

- ❗ Нужно научиться развёртывать приложение с GitHub Actions
  - Так [How to deploy a lambda function using github actions?](https://youtu.be/UQiRhKgQ5X0)
- ❗ Разобраться какое хранилище лучше выбрать для наших задач
- ❗ Разобраться как работать с хранилищем
  - Например [отсюда](https://youtu.be/4NOVYddMN-k) есть пример с `'boto3'` для взаимодействия с AWS
- ❗ Разобраться как забирать изображение фона карточки из хранилища и держать в памяти Lambda, например в нужной папке для передачи Python скрипту
- ❗ Нужно разобраться как после генерации изображения конкретной карточки делать её доступной по URL

## Артефакты

Артефакты вынесены во внешнее хранилище и загружаются в папку `'artifacts'` при запуске приложения

В данный момент (2022.12.12 15:14:43) внешнее хранилище — это Dropbox. Что бы с ним взаимодействовать нужно настроить приложение в личном кабинете [https://www.dropbox.com/developers/apps](https://www.dropbox.com/developers/apps). Затем скопировать `DROPBOX_ACCESS_TOKEN` в `.env`, который сейчас не обновляется автоматически.

### Артефакты персональных карточек

Артефакты персональных карточек должны сохранять следующую структуру, для прописанных в коде путей.

```bash
artifacts
└ card
  ├ background_image
  | └ card_{role}.png
  └ font
```

Структура задаётся структурой в хранилище.